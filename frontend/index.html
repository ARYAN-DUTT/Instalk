<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Instalk</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <h1 class="title-main">Instalk</h1>

  <div class="container">

    <!-- LOGIN -->
    <div id="loginBox" class="card">
      <h3>Login</h3>
      <input id="usernameInput" placeholder="Enter username" />
      <button id="loginBtn">Login</button>
      <div id="loginMsg" class="muted"></div>
    </div>

    <!-- LOBBY -->
    <div id="lobby" class="card hidden">
      <p>Logged in as <b id="meName"></b></p>
      <button id="findBtn">Find partner</button>
      <button id="stopBtn" class="hidden">Stop search</button>
      <div id="lobbyMsg" class="muted"></div>
    </div>

    <!-- CHAT (NEW REDESIGNED UI) -->
    <div id="chatCard" class="new-chat-card hidden">

      <p class="paired-text">Paired with <span id="partnerName"></span></p>

      <div class="chat-wrapper">

        <!-- PARTNER BUBBLE -->
        <div class="bubble-section">
          <p class="sender">Partner</p>
          <div class="bubble">
            <p id="partnerText"></p>
          </div>
        </div>

        <!-- YOU BUBBLE -->
        <div class="bubble-section">
          <p class="sender">You</span></p>

          <div class="user-bubble">
            <textarea 
              id="myInput" 
              maxlength="300"
              placeholder="Type your message..."></textarea>

            <button class="clear-btn" id="clearBtn">âœ–</button>
          </div>
        </div>

      </div>

      <div id="status" class="muted"></div>
      <button id="unpairBtn" class="end-btn">End Chat</button>

    </div>

  </div>

  <footer class="footer">Made by - Aryan Dutt</footer>

  <script src="/socket.io/socket.io.js"></script>
  <script src="app.js"></script>

  <!-- CLEAR BUTTON -->
  <script>
    document.getElementById("clearBtn").onclick = () => {
      const input = document.getElementById("myInput");
      input.value = "";
      input.dispatchEvent(new Event("input"));  // notify partner
    };
  </script>

  <!-- LIMIT PARTNER TEXT TO 300 -->
  <script>
    const partnerText = document.getElementById("partnerText");

    const observer = new MutationObserver(() => {
      if (partnerText.textContent.length > 300) {
        partnerText.textContent = partnerText.textContent.slice(0, 300);
      }
    });

    observer.observe(partnerText, {
      childList: true,
      characterData: true,
      subtree: true
    });
  </script>

</body>
</html>
